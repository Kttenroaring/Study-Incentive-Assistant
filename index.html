<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <link rel="manifest" href='data:application/manifest+json,{
    "name":"å­¦ä¹ åŠ©æ‰‹",
    "short_name":"åŠ©æ‰‹",
    "start_url":".",
    "display":"standalone",
    "background_color":"#ffffff",
    "theme_color":"#3498db",
    "icons": [
        {
            "src": "icon.png",
            "sizes": "512x512",
            "type": "image/png"
        }
    ]
}'>
<link rel="apple-touch-icon" href="icon.png">

<meta name="theme-color" content="#3498db">
   
<link rel="apple-touch-icon" href="icon.png">

<meta name="theme-color" content="#3498db">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å­¦ä¹ åŠ©æ‰‹ - ä»»åŠ¡åŒæ­¥ç»ˆç«¯</title>
    <style>
        :root { --primary: #3498db; --success: #2ecc71; --bg: #f0f2f5; }
        body { font-family: -apple-system, sans-serif; background: var(--bg); margin: 0; padding: 20px; display: flex; justify-content: center; }
        .card { background: white; width: 100%; max-width: 450px; border-radius: 24px; padding: 25px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); text-align: center; }
        
        /* ç§¯åˆ†åŒºåŸŸ */
        .points-box { margin-bottom: 25px; background: linear-gradient(135deg, #3498db, #2980b9); padding: 20px; border-radius: 18px; color: white; }
        .points-label { font-size: 14px; opacity: 0.9; }
        #points { font-size: 48px; font-weight: bold; margin: 5px 0; }
        
        /* ä»»åŠ¡åˆ—è¡¨åŒºåŸŸ */
        .section-title { text-align: left; font-size: 18px; font-weight: bold; color: #333; margin: 20px 0 10px; display: flex; justify-content: space-between; }
        #task-list { text-align: left; background: #fff; border-radius: 12px; }
        .task-item { display: flex; justify-content: space-between; align-items: center; padding: 15px 10px; border-bottom: 1px solid #f0f0f0; }
        .task-item:last-child { border-bottom: none; }
        .task-info { flex: 1; }
        .task-name { font-weight: 600; color: #2c3e50; font-size: 16px; }
        .task-meta { font-size: 12px; color: #95a5a6; margin-top: 4px; }
        
        /* çŠ¶æ€æ ‡ç­¾ */
        .status-tag { padding: 4px 10px; border-radius: 20px; font-size: 11px; font-weight: bold; }
        .status-done { background: #e8f8f0; color: #2ecc71; }
        .status-todo { background: #fef9e7; color: #f1c40f; }

        /* æŒ‰é’® */
        .btn-group { display: flex; gap: 10px; margin-top: 25px; }
        button { flex: 1; background: var(--primary); color: white; border: none; padding: 14px; border-radius: 12px; font-size: 15px; font-weight: 600; cursor: pointer; }
        button:active { filter: brightness(0.9); transform: scale(0.98); }
        .btn-config { background: #ecf0f1; color: #7f8c8d; max-width: 80px; }
        #status { font-size: 12px; color: #bdc3c7; margin-top: 15px; }
    </style>
</head>
<body>
    <div class="card">
        <div class="points-box">
            <div class="points-label">å½“å‰æ€»ç§¯åˆ†</div>
            <div id="points">---</div>
            <div id="status">ç­‰å¾…åŒæ­¥...</div>
        </div>
        
        <div class="section-title">
            <span>ğŸ“… ä»Šæ—¥ä»»åŠ¡æ¸…å•</span>
        </div>
        
        <div id="task-list">
            <p style="text-align:center; color:#ccc; padding:20px;">ç‚¹å‡»åˆ·æ–°è·å–ä»»åŠ¡...</p>
        </div>

        <div class="btn-group">
            <button onclick="fetchData()">ğŸ”„ åˆ·æ–°æ•°æ®</button>
            <button class="btn-config" onclick="resetToken()">âš™ï¸</button>
        </div>
    </div>

    <script>
        const GIST_ID = "d3d4d5e4e2293d4b528dac886951c6ac";
        const FILENAME = "study-incentive-assistant";

        async function fetchData() {
            let token = localStorage.getItem('github_token');
            if (!token) {
                token = prompt("è¯·è¾“å…¥ GitHub Token:");
                if (token) localStorage.setItem('github_token', token);
                else return;
            }

            const status = document.getElementById('status');
            status.innerText = "åŒæ­¥ä¸­...";

            try {
                const res = await fetch(`https://api.github.com/gists/${GIST_ID}`, {
                    headers: { "Authorization": `token ${token}` },
                    cache: 'no-store' // ç¡®ä¿ä¸è¯»å–æµè§ˆå™¨ç¼“å­˜
                });
                
                if (!res.ok) throw new Error("Token æ•ˆéªŒå¤±è´¥");

                const data = await res.json();
                const content = JSON.parse(data.files[FILENAME].content);
                
                // 1. æ›´æ–°ç§¯åˆ†
                document.getElementById('points').innerText = content.points;
                
                // 2. æ¸²æŸ“ä»»åŠ¡åˆ—è¡¨
                const listContainer = document.getElementById('task-list');
                listContainer.innerHTML = ""; 

                if (content.tasks && content.tasks.length > 0) {
                    content.tasks.forEach(task => {
                        const item = document.createElement('div');
                        item.className = 'task-item';
                        
                        const statusClass = task.done ? 'status-done' : 'status-todo';
                        const statusText = task.done ? 'å·²å®Œæˆ' : 'è¿›è¡Œä¸­';
                        
                        item.innerHTML = `
                            <div class="task-info">
                                <div class="task-name">${task.name}</div>
                                <div class="task-meta">å¥–åŠ±: ${task.pts} | ç›®æ ‡: ${task.target}åˆ†é’Ÿ</div>
                            </div>
                            <div class="status-tag ${statusClass}">${statusText}</div>
                        `;
                        listContainer.appendChild(item);
                    });
                } else {
                    listContainer.innerHTML = '<p style="text-align:center; color:#ccc; padding:20px;">æš‚æ— æ´»è·ƒä»»åŠ¡</p>';
                }

                status.innerText = "åŒæ­¥æˆåŠŸ: " + new Date().toLocaleTimeString();
            } catch (err) {
                alert("é”™è¯¯: " + err.message);
                status.innerText = "åŒæ­¥å¤±è´¥";
            }
        }

        function resetToken() {
            localStorage.removeItem('github_token');
            alert("Token å·²é‡ç½®");
        }

        if (localStorage.getItem('github_token')) fetchData();
    </script>
</body>
</html>
